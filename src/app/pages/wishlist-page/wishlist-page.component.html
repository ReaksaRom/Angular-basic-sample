<div class="wishlist-page min-vh-100 bg-light">
    <div class="container py-5">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="display-5 fw-bold text-dark">
                            <i class="fas fa-heart text-danger me-3"></i>My Wishlist
                        </h1>
                        <p class="text-muted">Save your favorite items for later</p>
                    </div>
                    <div class="text-end">
                        <div class="wishlist-stats">
                            <div class="h4 text-primary mb-1">{{ totalItems }} items</div>
                            <small class="text-muted">Total value: ${{ totalValue | number:'1.2-2' }}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4" *ngIf="wishlistProducts.length > 0">
            <div class="col-12">
                <div class="card quick-actions-card shadow-sm">
                    <div class="card-body py-3">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                    <span class="fw-semibold">Quick Actions:</span>
                                    <button class="btn btn-success btn-sm" (click)="moveAllToCart()">
                                        <i class="fas fa-cart-plus me-1"></i>Move All to Cart
                                    </button>
                                    <button class="btn btn-outline-light btn-sm" (click)="clearWishlist()">
                                        <i class="fas fa-trash me-1"></i>Clear Wishlist
                                    </button>
                                    <span *ngIf="hasDiscountedItems" class="badge bg-warning text-dark ms-2">
                                        {{ discountedItemsCount }} items on sale!
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    Items saved indefinitely
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter Bar -->
        <div class="row mb-4" *ngIf="wishlistProducts.length > 0">
            <div class="col-md-6">
                <div class="search-box">
                    <i class="fas fa-search position-absolute mt-2 ms-3 text-muted"></i>
                    <input type="text" class="form-control ps-5" placeholder="Search in wishlist..."
                        [(ngModel)]="searchTerm">
                </div>
            </div>
            <div class="col-md-6">
                <div class="d-flex gap-2 justify-content-md-end">
                    <select class="form-select" style="width: auto;" [(ngModel)]="selectedSort">
                        <option *ngFor="let option of sortOptions" [value]="option.value">
                            {{ option.label }}
                        </option>
                    </select>
                    <button class="btn btn-outline-secondary" (click)="searchTerm = ''; selectedSort = 'date-added'">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body text-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h5>Loading your wishlist...</h5>
                        <p class="text-muted">Getting your saved items ready</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && wishlistProducts.length === 0" class="row">
            <div class="col-12">
                <div class="card shadow-sm empty-state">
                    <div class="card-body text-center py-5">
                        <div class="empty-icon mb-4">
                            <i class="fas fa-heart fa-4x text-muted"></i>
                        </div>
                        <h3 class="text-dark mb-3">Your wishlist is empty</h3>
                        <p class="text-muted mb-4">
                            Start saving your favorite products to see them here.
                            You can add items to your wishlist while shopping.
                        </p>
                        <div class="d-flex gap-3 justify-content-center flex-wrap">
                            <a routerLink="/" class="btn btn-primary btn-lg">
                                <i class="fas fa-shopping-bag me-2"></i>Start Shopping
                            </a>
                            <a routerLink="/products" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-search me-2"></i>Browse Products
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Search Results -->
        <div *ngIf="!isLoading && wishlistProducts.length > 0 && filteredProducts.length === 0" class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4>No matching items found</h4>
                        <p class="text-muted mb-4">
                            No items in your wishlist match your search criteria.
                        </p>
                        <button class="btn btn-outline-primary" (click)="searchTerm = ''">
                            Clear Search
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wishlist Items -->
        <div *ngIf="!isLoading && filteredProducts.length > 0" class="row">
            <div class="col-12">
                <div class="wishlist-items">
                    <div class="row g-4">
                        <div class="col-xl-4 col-lg-6" *ngFor="let product of filteredProducts">
                            <div class="card wishlist-item-card h-100 shadow-sm">
                                <div class="card-body p-0">
                                    <!-- Product Image -->
                                    <div class="product-image position-relative">
                                        <img [src]="product.imageUrl" [alt]="product.name" class="card-img-top"
                                            (click)="viewProduct(product.id)"
                                            style="height: 200px; object-fit: cover; cursor: pointer;">

                                        <!-- Action Buttons -->
                                        <div class="action-buttons position-absolute top-0 end-0 m-2">
                                            <button class="btn btn-danger btn-sm rounded-circle"
                                                (click)="removeFromWishlist(product.id)" title="Remove from wishlist">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>

                                        <!-- Discount Badge -->
                                        <div *ngIf="product.discount > 0" class="position-absolute top-0 start-0 m-2">
                                            <span class="badge bg-danger">-{{ product.discount }}% OFF</span>
                                        </div>

                                        <!-- Stock Status -->
                                        <div class="position-absolute bottom-0 start-0 m-2">
                                            <span *ngIf="product.stock > 0" class="badge bg-success">In Stock</span>
                                            <span *ngIf="product.stock === 0" class="badge bg-danger">Out of
                                                Stock</span>
                                        </div>
                                    </div>

                                    <!-- Product Info -->
                                    <div class="p-3">
                                        <!-- Category -->
                                        <div class="mb-2">
                                            <small class="text-muted">{{ getCategoryName(product.categoryId) }}</small>
                                        </div>

                                        <!-- Product Name -->
                                        <h6 class="card-title mb-2" (click)="viewProduct(product.id)"
                                            style="cursor: pointer;">
                                            {{ product.name }}
                                        </h6>

                                        <!-- Rating -->
                                        <div class="mb-2">
                                            <span class="text-warning small">
                                                {{ '★'.repeat(Math.floor(getAverageRating(product.id))) }}{{
                                                '☆'.repeat(5 - Math.floor(getAverageRating(product.id))) }}
                                            </span>
                                            <small class="text-muted ms-1">({{ getAverageRating(product.id) |
                                                number:'1.1-1' }})</small>
                                        </div>

                                        <!-- Price -->
                                        <div class="price-section mb-3">
                                            <div class="d-flex align-items-center gap-2">
                                                <span class="h5 mb-0 text-success fw-bold">
                                                    ${{ getDiscountedPrice(product) | number:'1.2-2' }}
                                                </span>
                                                <span *ngIf="product.discount > 0"
                                                    class="text-muted text-decoration-line-through small">
                                                    ${{ product.price | number:'1.2-2' }}
                                                </span>
                                                <span *ngIf="product.discount > 0"
                                                    class="badge bg-warning text-dark small">
                                                    Save ${{ (product.price - getDiscountedPrice(product)) |
                                                    number:'1.2-2' }}
                                                </span>
                                            </div>
                                        </div>

                                        <!-- Description -->
                                        <p class="card-text text-muted small mb-3">
                                            {{ product.description | slice:0:100 }}{{ product.description.length > 100 ?
                                            '...' : '' }}
                                        </p>

                                        <!-- Action Buttons -->
                                        <div class="action-buttons-bottom">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary" (click)="addToCart(product)"
                                                    [disabled]="product.stock === 0">
                                                    <i class="fas fa-cart-plus me-2"></i>
                                                    {{ product.stock === 0 ? 'Out of Stock' : 'Add to Cart' }}
                                                </button>
                                                <button class="btn btn-outline-dark" (click)="viewProduct(product.id)">
                                                    <i class="fas fa-eye me-2"></i>View Details
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wishlist Summary -->
        <div *ngIf="!isLoading && filteredProducts.length > 0" class="row mt-5">
            <div class="col-12">
                <div class="card summary-card shadow-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6 class="fw-semibold mb-2">Wishlist Summary</h6>
                                <div class="d-flex flex-wrap gap-4 text-muted">
                                    <div>
                                        <i class="fas fa-box me-1"></i>
                                        {{ filteredProducts.length }} items
                                    </div>
                                    <div>
                                        <i class="fas fa-tag me-1"></i>
                                        {{ discountedItemsCount }} on sale
                                    </div>
                                    <div>
                                        <i class="fas fa-dollar-sign me-1"></i>
                                        Total: ${{ totalValue | number:'1.2-2' }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <button class="btn btn-primary me-2" (click)="moveAllToCart()">
                                    <i class="fas fa-cart-arrow-down me-2"></i>Add All to Cart
                                </button>
                                <a routerLink="/" class="btn btn-outline-primary">
                                    <i class="fas fa-plus me-2"></i>Continue Shopping
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tips Section -->
        <div *ngIf="!isLoading && wishlistProducts.length > 0" class="row mt-4">
            <div class="col-12">
                <div class="card tips-card border-0 bg-light">
                    <div class="card-body">
                        <h6 class="fw-semibold mb-3">
                            <i class="fas fa-lightbulb text-warning me-2"></i>Wishlist Tips
                        </h6>
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-bell me-1"></i>
                                    Get notified when prices drop
                                </small>
                            </div>
                            <div class="col-md-3 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-share-alt me-1"></i>
                                    Share your wishlist with friends
                                </small>
                            </div>
                            <div class="col-md-3 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    Items are saved indefinitely
                                </small>
                            </div>
                            <div class="col-md-3 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-mobile me-1"></i>
                                    Access from any device
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>