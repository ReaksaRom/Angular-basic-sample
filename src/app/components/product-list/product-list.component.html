<div class="product-list-container">

    <!-- Results Header -->
    <div class="results-header" *ngIf="hasProducts && showPagination">
        <div class="results-info">
            <span class="results-count">
                Showing {{ startIndex }} - {{ endIndex }} of {{ totalItems }} products
            </span>
        </div>
        <div class="layout-options">
            <button class="layout-btn" [class.active]="gridLayout === 'grid'" (click)="gridLayout = 'grid'"
                aria-label="Grid view">
                <i class="fas fa-th"></i>
            </button>
            <button class="layout-btn" [class.active]="gridLayout === 'list'" (click)="gridLayout = 'list'"
                aria-label="List view">
                <i class="fas fa-list"></i>
            </button>
        </div>
    </div>

    <!-- Products Grid/List -->
    <div [ngClass]="getGridClass()" *ngIf="hasProducts; else emptyState">

        <!-- Grid Layout -->
        <div class="row" *ngIf="gridLayout === 'grid'">
            <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-6 mb-4"
                *ngFor="let product of paginatedProducts; trackBy: trackByProductId">
                <app-product-card [product]="product" (addToCartEvent)="onAddToCart($event)"
                    (toggleWishlistEvent)="onToggleWishlist($event)">
                </app-product-card>
            </div>
        </div>

        <!-- List Layout -->
        <div class="list-layout-container" *ngIf="gridLayout === 'list'">
            <div class="list-product-item" *ngFor="let product of paginatedProducts; trackBy: trackByProductId">
                <app-product-card [product]="product" [layout]="'list'" (addToCartEvent)="onAddToCart($event)"
                    (toggleWishlistEvent)="onToggleWishlist($event)">
                </app-product-card>
            </div>
        </div>

    </div>

    <!-- Pagination Section -->
    <div class="pagination-wrapper" *ngIf="showPagination && totalPages > 1">

        <!-- Items Per Page & Info -->
        <div class="pagination-info-section">
            <div class="items-per-page-container">
                <label class="items-per-page-label">Show:</label>
                <select class="items-per-page-select" [value]="itemsPerPage" (change)="onItemsPerPageChange($event)">
                    <option *ngFor="let option of itemsPerPageOptions" [value]="option">
                        {{ option }} per page
                    </option>
                </select>
            </div>

            <div class="pagination-stats">
                <span class="page-info">
                    Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
                </span>
                <span class="total-items">
                    â€¢ {{ totalItems }} total items
                </span>
            </div>
        </div>

        <!-- Pagination Controls -->
        <div class="pagination-controls">
            <!-- Previous Button -->
            <button class="pagination-btn pagination-prev" (click)="previousPage()" [disabled]="currentPage === 1"
                aria-label="Previous page">
                <i class="fas fa-chevron-left"></i>
                <span>Previous</span>
            </button>

            <!-- Page Numbers -->
            <div class="page-numbers">
                <!-- First Page -->
                <button *ngIf="currentPage > 2" class="pagination-btn page-number" (click)="firstPage()"
                    aria-label="Go to first page">
                    1
                </button>

                <!-- Ellipsis before current page -->
                <span *ngIf="currentPage > 3" class="page-ellipsis">...</span>

                <!-- Pages around current page -->
                <ng-container *ngFor="let page of getVisiblePages()">
                    <button class="pagination-btn page-number" [class.active]="currentPage === page"
                        (click)="changePage(page)" [attr.aria-label]="'Go to page ' + page"
                        [attr.aria-current]="currentPage === page ? 'page' : null">
                        {{ page }}
                    </button>
                </ng-container>

                <!-- Ellipsis after current page -->
                <span *ngIf="currentPage < totalPages - 2" class="page-ellipsis">...</span>

                <!-- Last Page -->
                <button *ngIf="currentPage < totalPages - 1" class="pagination-btn page-number" (click)="lastPage()"
                    [attr.aria-label]="'Go to last page'">
                    {{ totalPages }}
                </button>
            </div>

            <!-- Next Button -->
            <button class="pagination-btn pagination-next" (click)="nextPage()" [disabled]="currentPage === totalPages"
                aria-label="Next page">
                <span>Next</span>
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Quick Jump -->
        <div class="quick-jump">
            <label class="jump-label">Go to page:</label>
            <div class="jump-controls">
                <input type="number" class="jump-input" [min]="1" [max]="totalPages" #pageInput
                    (keyup.enter)="jumpToPage(pageInput.value)" [placeholder]="currentPage.toString()">
                <button class="jump-btn" (click)="jumpToPage(pageInput.value)" [disabled]="!pageInput.value">
                    Go
                </button>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <ng-template #emptyState>
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3 class="empty-state-title">No products found</h3>
            <p class="empty-state-description">
                Try adjusting your search or filter criteria to find what you're looking for.
            </p>
            <div class="empty-state-actions">
                <button class="btn btn-primary" routerLink="/">
                    <i class="fas fa-home me-2"></i>
                    Return to Home
                </button>
            </div>
        </div>
    </ng-template>
</div>